#!/bin/sh

# This script intercepts calls to convert by xmonad's WallpaperSetter module,
# to preserve the aspect ratio of images.

main() {
	if echo "$*" | grep -q '-scale [0-9]\+x[0-9]\+!'; then
		args=$(echo "$*" | sed -e 's/\([0-9]\+x[0-9]\+\)! )/\1^ -gravity center -extent \1 +gravity )/g')
		convert $args
	else
		convert "$@"
	fi
}

# Make it appear as if this script were removed from $PATH, so that you can
# call a command with the same name.
remove_from_path() {
	local IFS cmd exe
	cmd="${0##*/}"
	IFS=:
	for dir in $PATH; do
		exe="$dir/$cmd"
		if test -x "$exe" -a "$exe" != "$0"; then
			eval "$cmd"'() { "'"$exe"'" "$@"; }'
			return
		fi
	done
	return 1
}

remove_from_path
main "$@"
