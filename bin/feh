#!/bin/sh

# This script intercepts calls to feh by xmonad's WallpaperSetter module,
# to cooperate with MATE managing the desktop background and icons.

main() {
	if test "$*" = "--no-xinerama --bg-tile --no-fehbg -"; then
		write_curbg
	else
		feh "$@"
	fi
}

write_curbg() {
	. "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"
	cat >"${XDG_PICTURES_DIR:-$HOME/Pictures}/backgrounds/curbg.jpg"
}

# Make it appear as if this script were removed from $PATH, so that you can
# call a command with the same name.
remove_from_path() {
	local IFS cmd exe
	cmd="${0##*/}"
	IFS=:
	for dir in $PATH; do
		exe="$dir/$cmd"
		if test -x "$exe" -a "$exe" != "$0"; then
			eval "$cmd"'() { "'"$exe"'" "$@"; }'
			return
		fi
	done
	return 1
}

remove_from_path
main "$@"
