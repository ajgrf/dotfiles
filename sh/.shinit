alias ls='LC_COLLATE=C ls --time-style=long-iso -A -1'
alias lc='LC_COLLATE=C command ls --time-style=long-iso -A'
alias l='lc -p'
alias la='ls'
alias ll='ls -la'
alias lh='ll -h'

alias ag='ag --nocolor --nogroup'
alias doch='eval sudo $(fc -ln -1)'
alias emacs='emacs -nw'
alias feh='feh -FZD-10'
alias feh1='feh --cycle-once'
alias nb='newsbeuter -q'
alias open='xdg-open'
alias reset='reset -Q'
alias rg='rg --color never --no-heading'
alias stack='stack --color never'

mkcd() { mkdir -p "$@" && cd "$1"; }

# automatically invoke sudo with apt when needed
apt() {
	local cmd skip

	# don't bother if we're root
	if [ "$(id -u)" -eq 0 ]; then
		command apt "$@"
		return
	fi

	# determine command given to apt
	for arg in "$@"; do
		if [ -n "$skip" ]; then
			skip=""
			continue
		fi
		case "$arg" in
		-h*|--help|-v*|--version)
			break
			;;
		-o|-c|-t|-a)
			skip=1
			;;
		-*)
			;;
		*)
			cmd="$arg"
			break
			;;
		esac
	done

	case "$cmd" in
	install|remove|update|upgrade|full-upgrade|edit-sources)
		sudo apt "$@"
		;;
	*)
		command apt "$@"
		;;
	esac
}

# set variable identifying the chroot you work in (used in the prompt below)
if [ -z "${debian_chroot:-}" ] && [ -r /etc/debian_chroot ]; then
	debian_chroot=$(cat /etc/debian_chroot)
fi

# pretty print working directory
ppwd() {
	local dir="${PWD}/" n="${1:-255}"

	case "$dir" in
	"${HOME}/"*)
		dir="~/${dir#$HOME/}"
		;;
	esac
	dir="${dir%/}"

	if test "${#dir}" -gt "$n"; then
		n=$(( n - 3 ))
		while test "${#dir}" -gt "$n"; do
			dir="${dir#?}"
		done
		dir="...${dir}"
	fi

	echo "$dir"
}

prompt() {
	local e=$?  title="" S='$'
	test "$e" -eq 0 && e=""
	#test "$USER_ID" -eq 0 && S='#'

	echo -n "${e:+$e|}${debian_chroot:+($debian_chroot)}${USER}@${HOSTNAME%%.*}:$(ppwd 28)$S "
}
PS1='$(prompt)'

#case "$TERM" in
#xterm*|rxvt*|st*|screen*|tmux*|dvtm*)
#	title="${USER}@${HOSTNAME%%.*}: ${dir}"
#	title=$'\001\r\001\e]0;'"$title"$'\a\001'
#	;;
#esac

case "$KSH_VERSION" in
*LEGACY\ KSH*|*MIRBSD\ KSH*)
	. "$HOME/.mkshrc"
	;;
esac
